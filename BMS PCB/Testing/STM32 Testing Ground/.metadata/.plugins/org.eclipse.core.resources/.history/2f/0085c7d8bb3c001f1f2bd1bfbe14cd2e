/*
 * bq76952.h
 * Header file for defining addresses and functions to communicate with the BQ76952 AFE
 *  Created on: Jul 7, 2024
 *      Author: farri
 */

#ifndef INC_BQ76952_H_
#define INC_BQ76952_H_

/* Addresses for R/W registers used for communication with the AFE ---------- */
// Address R/W registers
#define LOWER_ADDR_REG_READ 0x3E
#define UPPER_ADDR_REG_READ 0x3F
#define LOWER_ADDR_REG_WRITE 0xBE
#define UPPER_ADDR_REG_WRITE 0xBF

// Data buffer LSB addresses
#define READ_DATA_BUFF_LSB 0x40
#define WRITE_DATA_BUFF_LSB 0xC0

// Addresses for writing checksum and data length info for transactions
#define READ_CHECKSUM_ADDR 0x60
#define READ_DATALEN_ADDR 0x61
#define WRITE_CHECKSUM_ADDR 0xE0
#define WRITE_DATALEN_ADDR 0xE1

/* Addresses for the RAM registers ------------------------------------------ */
// Calibration gains
#define CAL_GAIN_CL1 0x9180
#define CAL_GAIN_CL2 0x9182
#define CAL_GAIN_CL3 0x9184
#define CAL_GAIN_CL4 0x9186
#define CAL_GAIN_CL5 0x9188
#define CAL_GAIN_CL6 0x918A
#define CAL_GAIN_CL7 0x918C
#define CAL_GAIN_CL8 0x918E
#define CAL_GAIN_CL9 0x9190
#define CAL_GAIN_CL10 0x9192
#define CAL_GAIN_CL11 0x9194
#define CAL_GAIN_CL12 0x9196
#define CAL_GAIN_CL13 0x9198
#define CAL_GAIN_CL14 0x919A
#define CAL_GAIN_CL15 0x919C
#define CAL_GAIN_CL16 0x919E
#define CAL_GAIN_PACK 0x91A0
#define CAL_GAIN_TOS 0x91A2
#define CAL_GAIN_LD 0x91A4
#define CAL_GAIN_ADC 0x91A6
#define CAL_GAIN_CC 0x91A8
#define CAL_GAIN_CAP 0x91AC

// Calibration temperature offsets
#define CAL_OFST_VCELL 0x91B0
#define CAL_OFST_VDIV 0x91B2
#define CAL_OFST_CLMB_CTR 0x91C6
#define CAL_OFST_BRD 0x91C6
#define CAL_OFST_INT_TMP 0x91CA
#define CAL_OFST_CFETOFF_TEMP 0x91CB
#define CAL_OFST_DFETOFF_TEMP 0x91CC
#define CAL_OFST_ALERT_TEMP 0x91CD
#define CAL_OFST_TS1_TEMP 0x91CE
#define CAL_OFST_TS2_TEMP 0x91CF
#define CAL_OFST_TS3_TEMP 0x91D0
#define CAL_OFST_HDQ_TEMP 0x91D1
#define CAL_OFST_DCHG_TEMP 0x91D2
#define CAL_OFST_DDSG_TEMP 0x91D3

// Calibration internal temperature model
#define CAL_INTTEMP_GAIN 0x91E2
#define CAL_INTTEMP_BASE 0x91E4
#define CAL_INTTEMP_MAX_AD 0x91E6
#define CAL_INTTEMP_MAX_TEMP 0x91E8

// Calibration 18K temperature model
#define CAL_18KTEMP_CF_A1 0x91EA
#define CAL_18KTEMP_CF_A2 0x91EC
#define CAL_18KTEMP_CF_A3 0x91EE
#define CAL_18KTEMP_CF_A4 0x91F0
#define CAL_18KTEMP_CF_A5 0x91F2
#define CAL_18KTEMP_CF_B1 0x91F4
#define CAL_18KTEMP_CF_B2 0x91F6
#define CAL_18KTEMP_CF_B3 0x91F8
#define CAL_18KTEMP_CF_B4 0x91FA
#define CAL_18KTEMP_ADC0 0x91FE

// Calibration 180K temperature model
#define CAL_180KTEMP_CF_A1 0x9200
#define CAL_180KTEMP_CF_A2 0x9202
#define CAL_180KTEMP_CF_A3 0x9204
#define CAL_180KTEMP_CF_A4 0x9206
#define CAL_180KTEMP_CF_A5 0x9208
#define CAL_180KTEMP_CF_B1 0x920A
#define CAL_180KTEMP_CF_B2 0x920C
#define CAL_180KTEMP_CF_B3 0x920E
#define CAL_180KTEMP_CF_B4 0x9210
#define CAL_180KTEMP_ADC0 0x9214

// Calibration custom temperature model
#define CAL_CSTMTEMP_CF_A1 0x9216
#define CAL_CSTMTEMP_CF_A2 0x9218
#define CAL_CSTMTEMP_CF_A3 0x921A
#define CAL_CSTMTEMP_CF_A4 0x921C
#define CAL_CSTMTEMP_CF_A5 0x921E
#define CAL_CSTMTEMP_CF_B1 0x9220
#define CAL_CSTMTEMP_CF_B2 0x9222
#define CAL_CSTMTEMP_CF_B3 0x9224
#define CAL_CSTMTEMP_CF_B4 0x9226
#define CAL_CSTMTEMP_RC0 0x9228
#define CAL_CSTMTEMP_ADC0 0x922A

/* Function prototypes for communicating with the BQ76952 AFE --------------- */
// Functions to handle communication with the AFE
void DirectCmdRead(uint8_t cmd, uint8_t *returnData, uint8_t len);
void SubCmdNoData(uint16_t cmd);
void SubCmdReadData(uint16_t cmd, uint8_t *returnData, uint8_t len);
void RAMRegisterRead(uint16_t addr, uint8_t *returnData, uint8_t len);
void RAMRegisterWrite(uint16_t addr, uint8_t *writeData, uint8_t len);

// Helper functions that do the handling for verifying the AFE received a SPI command
void AFETransmitReadCmd(uint8_t *txBytes, uint8_t *rxBytes, uint8_t arrSize);
void AFETransmitWriteCmd(uint8_t *txBytes, uint8_t *rxBytes, uint8_t arrSize);

#endif /* INC_BQ76952_H_ */
